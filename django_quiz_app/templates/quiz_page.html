<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" ></script>
    <script>
        $(function(){
            
                $.get("http://127.0.0.1:8000/get_results/{{quiz_id}}",function(result_data,result_status){
                var result_var = 0;
                var abcna = "";
                result_data.forEach(function(result_data_data){
                    if('{{currently_user}}' == result_data_data.name ){
                        result_var++;
                    }
                });
                if(result_var == 1){
                        $("h2").hide()
                        $("#submit").hide()
                        $("input").hide()
                        abcna = "<h1>" + "Bu Teste Zaten Girildi" + "</h1>"
                        $("#abc").html(abcna);
                    
                }
                //else if(result_data.a == "a"){
                else{
                    $("#submit").click(function(){
                $.get("http://127.0.0.1:8000/get_all/{{quiz_id}}", function(data, status){
                    var _text = '';
                    var l = 0;
                    var array = [] 
                    var all_answer_correct = true;
                    data.forEach(function(quiz) {
                        quiz.questions.forEach(function(question) {
                            /*var x = document.getElementById(question.id).value;
                            _text += '<div>';
                            _text += '<h2>' + "Correct Answer: " + question.correct_answer + '</h2>';
                            _text += '<h2>' + "Answer: " + x + '</h2>';
                            
                            _text += '</div>';*/
                            $("#abc").html(_text);

                            if(question.correct_answer == x ){
                                array[l] = true
                                
                            }
                            else if(question.correct_answer != x){
                                array[l] = false
                            }
                            l++;
                            
                            console.log(l)
                            
                        });
                    });
                    var co_ans_num = 0;
                    alert(array)
                    for(var o = 0; o < l;o++){
                        if(array[o] == false){
                            all_answer_correct = false;
                        }
                        else if(array[o] != false){
                            co_ans_num++;
                        }
                    }
                    if(all_answer_correct == true){
                        alert("Tebrikler" + (co_ans_num/l) * 100)
                    }
                    else{alert("Başarı Puanın: " + (co_ans_num/l) * 100)}

                    let csrftoken = '{{ csrf_token }}'
                    $.ajax({
                        url: "/post_results",
                        type: "POST",
                        headers: {
                            'X-CSRFToken': csrftoken
                        },
                        data: JSON.stringify({
                            "name": {{currently_user}},
                            "success": (co_ans_num/l) * 100,
                            "results": [{{quiz_id}}]
                        }),
                        contentType: "application/json",
                        success: function(response){
                            console.log(response);
                        },
                        error: function(xhr, status, error){
                            console.log(xhr.responseText);
                        }
                });
                })});};
            });
                
            });
        
    </script>
</head>
<body>
    <a href="/"><button id="back">BACK</button></a>
    <!--<h2>Currently User: {{currently_user}}</h2>-->
    {% for i in all_questions %}
        <h2>{{ i.name }}</h2>

        {% for j in i.questions.all %}
            <h2>{{ j.name }}</h2>
            <h2>{{ j.header }}</h2>
            <h2>A - {{ j.a }}</h2>
            <h2>B - {{ j.b }}</h2>
            <h2>C - {{ j.c }}</h2>
            <h2>D - {{ j.d }}</h2>
            <h2>{{j.id}}</h2>
            <input id="{{j.id}}" type="text">
            
        {% endfor %}
    {% endfor %}
    <button id="submit">BITTI</button>
    <h1 id="abc"></h1>
</body>
</html>
